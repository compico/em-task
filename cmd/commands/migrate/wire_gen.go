// Code generated by Wire. DO NOT EDIT.

//go:generate go run -mod=mod github.com/google/wire/cmd/wire
//go:build !wireinject
// +build !wireinject

package migrate

import (
	"context"
	di2 "github.com/compico/em-task/cmd/di"
	"github.com/compico/em-task/internal/pkg/config"
	"github.com/compico/em-task/pkg/logger"
	"github.com/golang-migrate/migrate/v4"
)

import (
	_ "github.com/golang-migrate/migrate/v4/database/postgres"
	_ "github.com/golang-migrate/migrate/v4/source/file"
)

// Injectors from wire.go:

func InitializeMigrator(ctx context.Context, filepath string) (*Migrator, error) {
	configConfig, err := config.NewConfig(filepath)
	if err != nil {
		return nil, err
	}
	slog := di2.SlogConfigProvider(configConfig)
	level := di2.SlogLevelProvider(slog)
	writer := di2.SlogWriterProvider()
	slogReplacerAttribute := di2.SlogReplacerAttrProvider()
	handlerOptions := di2.SlogJsonHandlerOptionsProvider(slog, slogReplacerAttribute)
	handler := di2.SlogJsonHandlerProvider(writer, handlerOptions)
	slogLogger := di2.SlogProvider(handler)
	loggerLogger := logger.NewLogger(level, slogLogger)
	database := di2.DatabaseConfigProvider(configConfig)
	migrate, err := MigrateProvider(database)
	if err != nil {
		return nil, err
	}
	migrator := &Migrator{
		logger:  loggerLogger,
		migrate: migrate,
	}
	return migrator, nil
}

// wire.go:

type (
	Migrator struct {
		logger  logger.Logger
		migrate *migrate.Migrate
	}
)

func MigrateProvider(dbConfig config.Database) (*migrate.Migrate, error) {
	return migrate.New(
		dbConfig.GetMigrationSource(),
		dbConfig.GetDsn(),
	)
}
